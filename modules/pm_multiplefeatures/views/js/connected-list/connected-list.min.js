$(document).ready(function(){$.extend($.expr[":"],{containsNonCaseSensitive:function(a,b,c,d){return(a.textContent||a.innerText||"").toLowerCase().indexOf((c[3]||"").toLowerCase())>=0}}),$.fn.pmConnectedList=function(a){var b={availableListTitle:null,selectedListTitle:null,enableAddAllButton:!0,enableRemoveAllButton:!0,enableSearchInput:!0,searchInputPlaceHolder:"Search",addAllButtonLabel:"Add all",addAllButtonClasses:null,removeAllButtonLabel:"Remove all",removeAllButtonClasses:null,removeAllCallback:null,addAllCallback:null},c=$.extend({},b,a);return this.each(function(){function a(){l.hasClass("filtering-mode")?($("li.matching",l).each(function(){$(this).data("relatedOption").prop("selected",!0).attr("already-selected","1")}),$("li.matching",l).appendTo(k)):($("li",l).appendTo(k),$("option",i).prop("selected",!0).attr("already-selected","1")),e(),d()}function b(){$("li",k).appendTo(l),$("option",i).prop("selected",!1).attr("already-selected","0"),e(),d()}function d(){1==c.enableSearchInput&&p.trigger("change")}function e(){0==$("li",l).size()?(l.addClass("empty-list"),c.enableAddAllButton&&q.prop("disabled",!0)):(l.removeClass("empty-list"),c.enableAddAllButton&&q.prop("disabled",!1)),0==$("li",k).size()?(k.addClass("empty-list"),c.enableRemoveAllButton&&r.prop("disabled",!0)):(k.removeClass("empty-list"),c.enableRemoveAllButton&&r.prop("disabled",!1))}function f(a,b){originalItem=$('option[value="'+$(a).data("val")+'"]',i),1==originalItem.size()&&(b?h(a,a):(1==$("li:last-child",k).size()?(lastItem=$("option:selected",i).last(),$("option",i).size()>1&&$(lastItem).after(originalItem)):(lastItem=$("option:first-child",i),$("option",i).size()>1&&$(lastItem).before(originalItem)),$(a).appendTo(k)),$(originalItem).prop("selected",!0).attr("already-selected","1"),e(),d())}function g(a,b){originalItem=$('option[value="'+$(a).data("val")+'"]',i),1==originalItem.size()&&($("option",i).size()>1&&(1==$("li:last-child",l).size()?lastItem=$("option",i).last():lastItem=$("option:selected",i).last()),b||$(a).appendTo(l),$(originalItem,i).prop("selected",!1).attr("already-selected","0"),e(),d())}function h(a,b){if(originalItem=$('option[value="'+$(a).data("val")+'"]',i),1==originalItem.size()){if(itemValue=$(a).data("val"),prevItem=$(b).prev(),prevValue=prevItem.data("val"),"undefined"!=typeof prevValue&&itemValue!=prevValue)return referenceItem=$('option[value="'+prevValue+'"]',i),void(1==referenceItem.size()&&$(referenceItem).after(originalItem));if(nextItem=$(b).next(),nextValue=nextItem.data("val"),"undefined"!=typeof nextValue&&itemValue!=nextValue)return referenceItem=$('option[value="'+nextValue+'"]',i),void(1==referenceItem.size()&&$(referenceItem).before(originalItem))}}var i=$(this);if(1!=i.data("initDone")){i.data("initDone",!0),i.prop("multiple",!0);var j=(Math.random()+"").replace("0.",""),k=$("<ul />").attr("id","selected-list-"+j),l=$("<ul />").attr("id","available-list-"+j);$("option",i).each(function(){listItem=$("<li />").html($(this).html()).data("val",$(this).val()).data("relatedOption",$(this)),$(this).is(":selected")?(k.append(listItem),$(this).attr("already-selected","1")):$(this).attr("selected")?(k.append(listItem),$(this).prop("selected",!0),$(this).attr("already-selected","1")):(l.append(listItem),$(this).attr("already-selected","0")),$(this).data("optionListItem",listItem)});var m=$('<div class="connected-list-container" />'),n=$('<div class="available-list-container" />'),o=$('<div class="selected-list-container" />'),p=null;if(null!=c.availableListTitle&&n.append('<span class="list-title">'+c.availableListTitle+"</span>"),null!=c.selectedListTitle&&o.append('<span class="list-title">'+c.selectedListTitle+"</span>"),1==c.enableSearchInput&&(m.addClass("connected-list-has-search-filter"),p=$('<input class="connected-list-search-input" type="text" placeholder="'+c.searchInputPlaceHolder+'" value="" />'),n.append(p)),n.append(l),o.append(k),l.on("click","li",function(a){f(this,!1)}),k.on("click","li",function(){g(this,!1)}),1==c.enableSearchInput&&p.on("keyup change",function(){if($(this).val().length>0){l.addClass("filtering-mode"),l.find("li.matching").removeClass("matching");var a=i.find("option[already-selected=0]:containsNonCaseSensitive("+$(this).val()+")");a.each(function(){$(this).data("optionListItem").addClass("matching")});var b=a.size();$(".list-title",n).html(c.availableListSearchTitle.replace("%nbResults%",b))}else l.removeClass("filtering-mode"),l.find("li.not-matching").removeClass("not-matching"),$(".list-title",n).html(c.availableListTitle)}),c.enableAddAllButton){$availablelistActionsContainer=$('<div class="list-actions-container" />');var q=$("<button />").html(c.addAllButtonLabel).appendTo($availablelistActionsContainer);c.addAllButtonClasses&&q.addClass(c.addAllButtonClasses),q.on("click",function(b){b.preventDefault(),a()}),n.append($availablelistActionsContainer)}if(c.enableRemoveAllButton){$selectedlistActionsContainer=$('<div class="list-actions-container" />');var r=$("<button />").html(c.removeAllButtonLabel).appendTo($selectedlistActionsContainer);c.removeAllButtonClasses&&r.addClass(c.removeAllButtonClasses),r.on("click",function(a){a.preventDefault(),b(),"function"==typeof c.removeAllCallback&&c.removeAllCallback(i)}),o.append($selectedlistActionsContainer)}m.append(n),m.append(o),i.hide(),m.insertAfter(i),$("#available-list-"+j).sortable({items:"li:visible",connectWith:"#selected-list-"+j,receive:function(a,b){g(b.item,!0)},helper:"clone",opacity:.2}),$("#selected-list-"+j).sortable({items:"li:visible",connectWith:"#available-list-"+j,receive:function(a,b){f(b.item,!0)},change:function(a,b){h(b.item,b.placeholder)},helper:"clone",opacity:.2}),e()}})}});